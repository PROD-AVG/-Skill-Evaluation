<?xml version="1.0" encoding="UTF-8"?><record_update table="sysauto_script">
    <sysauto_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <business_calendar/>
        <condition/>
        <conditional>false</conditional>
        <entered_time/>
        <name>Reminder to submit Skill Evaluation</name>
        <offset/>
        <offset_type>0</offset_type>
        <run_as display_value="Dinh Do Quang">5c96c4c5dbd20010d606e04a489619dc</run_as>
        <run_as_tz/>
        <run_dayofmonth>1</run_dayofmonth>
        <run_dayofweek>1</run_dayofweek>
        <run_period/>
        <run_start>2020-12-15 06:45:45</run_start>
        <run_time>1969-12-31 17:00:00</run_time>
        <run_type>weekly</run_type>
        <script><![CDATA[(function(){
	sendEmailNotification();
})();

function sendEmailNotification() {
	var gdt = new GlideDateTime();
	gdt.addMonthsLocalTime(-3); // subtract 3 months 

	var userGrp = new GlideRecord('sys_user_grmember');
	userGrp.addQuery('group', '54a6ae02db078490d606e04a48961928'); // Skill Evaluation User group
	userGrp.addQuery('user.user_name','!=','TNGUYEN547'); // exclude Nguyen Cong Triet
	userGrp.query();
	while (userGrp.next()) {
		if (userGrp.user.title.getDisplayValue() != 'COE' && userGrp.user.active == true ) {
			// Get user and manager ID
			var user = new GlideRecord('sys_user');
			user.get(userGrp.user);
			var recipients = user.sys_id;
			// add manager, exclude Nguyen Cong Triet 
			if (user.manager && user.manager.active && user.manager.user_name != 'TNGUYEN547')
				recipients += ',' + user.manager;
			// Get latest completed submission of user
			var se = new GlideRecord('x_424363_ski_eva_1_submission');
			se.addQuery('state', '3'); // Complete
			se.addQuery('assigned_to', userGrp.user.sys_id);
			se.orderByDesc('sys_updated_on');
			se.query();
			if (se.next()) {
				if (se.sys_updated_on < gdt) // if last evaluation is older than 3 months, send an event
					gs.eventQueue('x_424363_ski_eva_1.skill.eval.reminder', user, recipients);
			} else { // user does not have any completed submission, also send event
				gs.eventQueue('x_424363_ski_eva_1.skill.eval.reminder', user, recipients);
			}
		}
	}
}
]]></script>
        <sys_class_name>sysauto_script</sys_class_name>
        <sys_created_by>DDO9</sys_created_by>
        <sys_created_on>2020-12-15 08:47:05</sys_created_on>
        <sys_id>6a81125edbc1a050d606e04a489619ed</sys_id>
        <sys_mod_count>25</sys_mod_count>
        <sys_name>Reminder to submit Skill Evaluation</sys_name>
        <sys_package display_value="Skill Evaluation" source="x_424363_ski_eva_1">f8037c7c072900101531f7108c1ed08f</sys_package>
        <sys_policy/>
        <sys_scope display_value="Skill Evaluation">f8037c7c072900101531f7108c1ed08f</sys_scope>
        <sys_update_name>sysauto_script_6a81125edbc1a050d606e04a489619ed</sys_update_name>
        <sys_updated_by>hnguyen419</sys_updated_by>
        <sys_updated_on>2023-11-14 07:56:48</sys_updated_on>
        <time_zone/>
        <upgrade_safe>false</upgrade_safe>
    </sysauto_script>
</record_update>
