<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_fix">
    <sys_script_fix action="INSERT_OR_UPDATE">
        <before>false</before>
        <description/>
        <name>Valid PROD Data Fix </name>
        <record_for_rollback>false</record_for_rollback>
        <script><![CDATA[// force false to all as a full reset activity.
var gr = new GlideRecord('x_424363_ski_eva_1_submission');
gr.setValue('valid', false);
gr.updateMultiple();

var ga = new GlideAggregate('x_424363_ski_eva_1_submission');
// focus on "Completed" submission only.
ga.addQuery('state', 3);
ga.groupBy('assigned_to');
ga.query();
while(ga.next()){
	var isFirstRecord = true;
	var gr2 = new GlideRecord('x_424363_ski_eva_1_submission');
	gr2.addQuery('assigned_to',ga.assigned_to);
	gr2.orderByDesc('number');
	gr2.query();
	while(gr2.next()){
		// add code to update first record to true, the rest one is false (if false is default, no need update to false)
		if(isFirstRecord && gr2.getValue('state') == 3) {
			gr2.setValue('valid', true);
			isFirstRecord = false;
			gs.info('[Fix Script]: ' + gr2.getValue('number') + 'update Valid: ' + gr2.valid);
			gr2.update();
		} else {			
			if(gr2.getValue('valid')) {
				gr2.setValue('valid', false);
				gs.info('[Fix Script]: ' + gr2.getValue('number') + 'update Valid: ' + gr2.valid);
				gr2.update();
			}
		}						
	}
}
]]></script>
        <sys_class_name>sys_script_fix</sys_class_name>
        <sys_created_by>thoang44</sys_created_by>
        <sys_created_on>2020-04-21 06:03:52</sys_created_on>
        <sys_id>b74dd439db5c5490d606e04a4896193d</sys_id>
        <sys_mod_count>10</sys_mod_count>
        <sys_name>Valid PROD Data Fix </sys_name>
        <sys_package display_value="Skill Evaluation" source="x_424363_ski_eva_1">f8037c7c072900101531f7108c1ed08f</sys_package>
        <sys_policy/>
        <sys_scope display_value="Skill Evaluation">f8037c7c072900101531f7108c1ed08f</sys_scope>
        <sys_update_name>sys_script_fix_b74dd439db5c5490d606e04a4896193d</sys_update_name>
        <sys_updated_by>vnguyen94</sys_updated_by>
        <sys_updated_on>2020-04-21 08:32:44</sys_updated_on>
        <unloadable>false</unloadable>
    </sys_script_fix>
</record_update>
